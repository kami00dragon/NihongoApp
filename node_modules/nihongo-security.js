// M√≥dulo de seguridad para NihongoApp
(function(global) {
    'use strict';
    
    const Security = {
        // Protecci√≥n XSS
        sanitize: function(text) {
            if (typeof text !== 'string') return text;
            return text
                .replace(/[<]/g, '&lt;')
                .replace(/[>]/g, '&gt;')
                .replace(/["]/g, '&quot;')
                .replace(/[']/g, '&#x27;')
                .replace(/\//g, '&#x2F;');
        },
        
        // Detecci√≥n de manipulaci√≥n
        integrityCheck: function() {
            const originalTitle = 'Kana Espa√±ol - Funcional y Corregido';
            if (document.title !== originalTitle) {
                document.title = originalTitle;
                console.warn('üö® Intento de manipulaci√≥n detectado - T√≠tulo restaurado');
            }
        },
        
        // Protecci√≥n contra inyecci√≥n de scripts
        preventInjection: function() {
            document.addEventListener('DOMContentLoaded', function() {
                const scripts = document.getElementsByTagName('script');
                for (let script of scripts) {
                    if (script.src && !script.src.includes('github.io')) {
                        console.warn('üö® Script externo detectado y bloqueado:', script.src);
                        script.parentNode.removeChild(script);
                    }
                }
            });
        },
        
        // Verificaci√≥n de integridad del DOM
        monitorDOM: function() {
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'childList') {
                        mutation.addedNodes.forEach(function(node) {
                            if (node.nodeName === 'SCRIPT' && node.src) {
                                if (!node.src.includes('github.io')) {
                                    console.warn('üö® Script malicioso detectado:', node.src);
                                    node.parentNode.removeChild(node);
                                }
                            }
                        });
                    }
                });
            });
            
            observer.observe(document.body || document.documentElement, {
                childList: true,
                subtree: true
            });
            
            return observer;
        },
        
        init: function() {
            this.integrityCheck();
            this.preventInjection();
            this.monitorDOM();
            
            // Verificaci√≥n peri√≥dica
            setInterval(() => {
                this.integrityCheck();
            }, 1000);
            
            console.log('üõ°Ô∏è Sistema de seguridad NihongoApp activado');
        }
    };
    
    if (typeof module !== 'undefined' && module.exports) {
        module.exports = Security;
    } else {
        global.NihongoSecurity = Security;
    }
    
})(typeof window !== 'undefined' ? window : global);
